---
phase: 01-foundation-authentication
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - turbo.json
  - pnpm-workspace.yaml
  - package.json
  - Anchor.toml
  - Cargo.toml
  - rust-toolchain.toml
  - .gitignore
  - programs/gsd-hub/Cargo.toml
  - programs/gsd-hub/src/lib.rs
  - programs/gsd-hub/src/state/mod.rs
  - programs/gsd-hub/src/state/developer.rs
  - programs/gsd-hub/src/instructions/mod.rs
  - programs/gsd-hub/src/instructions/register.rs
  - programs/gsd-hub/src/instructions/update_hash.rs
  - programs/gsd-hub/src/errors.rs
  - programs/gsd-hub/tests/register.test.ts
  - packages/types/package.json
  - packages/types/tsconfig.json
  - packages/types/src/index.ts
  - packages/types/src/profile.ts
  - packages/utils/package.json
  - packages/utils/tsconfig.json
  - packages/utils/src/index.ts
  - packages/utils/src/pda.ts
  - packages/utils/src/hash.ts
autonomous: true

must_haves:
  truths:
    - "Anchor program compiles and deploys to localnet/devnet with register_developer and update_profile_hash instructions"
    - "DeveloperProfile PDA is derived deterministically from wallet address with correct 89-byte size"
    - "Shared types and utils packages are importable across the monorepo"
  artifacts:
    - path: "programs/gsd-hub/src/lib.rs"
      provides: "Anchor program entry point with register_developer and update_profile_hash instructions"
      contains: "declare_id!"
    - path: "programs/gsd-hub/src/state/developer.rs"
      provides: "DeveloperProfile account struct with authority, bump, timestamps, profile_hash"
      contains: "DeveloperProfile"
    - path: "programs/gsd-hub/src/instructions/register.rs"
      provides: "Developer registration instruction with PDA init"
      contains: "RegisterDeveloper"
    - path: "programs/gsd-hub/src/instructions/update_hash.rs"
      provides: "Profile hash update instruction with authority check"
      contains: "UpdateProfileHash"
    - path: "packages/utils/src/pda.ts"
      provides: "getDeveloperProfilePDA helper"
      exports: ["getDeveloperProfilePDA"]
    - path: "packages/utils/src/hash.ts"
      provides: "computeProfileHash helper"
      exports: ["computeProfileHash"]
  key_links:
    - from: "programs/gsd-hub/src/instructions/register.rs"
      to: "programs/gsd-hub/src/state/developer.rs"
      via: "Account<DeveloperProfile> with init constraint"
      pattern: "Account.*DeveloperProfile"
    - from: "packages/utils/src/pda.ts"
      to: "programs/gsd-hub/src/instructions/register.rs"
      via: "Matching PDA seeds [b'developer', wallet]"
      pattern: "developer.*toBuffer"
---

<objective>
Scaffold the Turborepo monorepo and build the Anchor on-chain program with developer profile PDA instructions, plus shared TypeScript packages for types and utilities.

Purpose: Everything else in Phase 1 depends on this foundation -- the monorepo structure, the on-chain program, and the shared packages. This plan produces the artifacts that Plan 02 (web app) and Plan 03 (profile features) build upon.
Output: Working monorepo with compiled Anchor program (tested on localnet), shared @gsd/types and @gsd/utils packages.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-authentication/01-RESEARCH.md
@.planning/phases/01-foundation-authentication/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Turborepo monorepo with pnpm workspaces and shared packages</name>
  <files>
    turbo.json
    pnpm-workspace.yaml
    package.json
    .gitignore
    rust-toolchain.toml
    packages/types/package.json
    packages/types/tsconfig.json
    packages/types/src/index.ts
    packages/types/src/profile.ts
    packages/utils/package.json
    packages/utils/tsconfig.json
    packages/utils/src/index.ts
    packages/utils/src/pda.ts
    packages/utils/src/hash.ts
  </files>
  <action>
    Create the monorepo root structure:

    1. Root `package.json` with name "gsd-community-hub", `"type": "module"`, scripts for build/dev/lint, and devDependencies for turborepo and typescript.

    2. `pnpm-workspace.yaml` defining workspace packages: `apps/*`, `packages/*`.

    3. `turbo.json` with pipeline for build (dependsOn: ^build), dev (persistent: true), lint, and test tasks.

    4. `rust-toolchain.toml` pinning Rust to `1.91.1` with `[toolchain]` channel and components (rustfmt, clippy).

    5. `.gitignore` covering: node_modules, .next, target/, dist/, .env*.local, *.so, generated/, .turbo.

    6. `packages/types/` -- shared TypeScript types package:
       - `package.json`: name "@gsd/types", type "module", main/types pointing to src/index.ts, no build step (consumed as TS source via workspace protocol)
       - `tsconfig.json`: strict mode, ES2022 target, moduleResolution "bundler"
       - `src/profile.ts`: Export `DeveloperProfile` interface (walletAddress: string, displayName?: string, bio?: string, avatarUrl?: string, githubUrl?: string, twitterUrl?: string, websiteUrl?: string, profileHash?: string, onChainPda?: string, createdAt: Date, updatedAt: Date). Export `CreateProfileInput` type (displayName: string, bio: string, githubUrl?: string, twitterUrl?: string, websiteUrl?: string). Export `UpdateProfileInput` as Partial of CreateProfileInput.
       - `src/index.ts`: Re-export all from profile.ts

    7. `packages/utils/` -- shared utility package:
       - `package.json`: name "@gsd/utils", type "module", dependencies on @solana/web3.js@1
       - `tsconfig.json`: strict mode, ES2022, moduleResolution "bundler"
       - `src/pda.ts`: Export `getDeveloperProfilePDA(wallet: PublicKey, programId: PublicKey): [PublicKey, number]` using `PublicKey.findProgramAddressSync` with seeds `[Buffer.from("developer"), wallet.toBuffer()]`. Export `DEVELOPER_SEED = "developer"` constant.
       - `src/hash.ts`: Export `computeProfileHash(profile: CreateProfileInput): Promise<Uint8Array>` that does deterministic JSON serialization (filter out undefined values, sort remaining keys alphabetically, JSON.stringify, SHA-256 via crypto.subtle.digest, return Uint8Array). Also export `profileHashToBytes32(hash: Uint8Array): number[]` that converts to Array.from for Anchor compatibility.
       - `src/index.ts`: Re-export all from pda.ts and hash.ts

    Run `pnpm install` at root to verify workspace resolution.
  </action>
  <verify>
    - `pnpm install` succeeds without errors
    - `ls packages/types/src/profile.ts packages/utils/src/pda.ts packages/utils/src/hash.ts` all exist
    - TypeScript compilation check: `cd packages/utils && npx tsc --noEmit` passes
  </verify>
  <done>
    Monorepo root exists with turbo.json, pnpm-workspace.yaml, and two shared packages (@gsd/types with profile types, @gsd/utils with PDA derivation and hash computation). pnpm workspace resolution works.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build Anchor program with DeveloperProfile PDA and registration/update instructions</name>
  <files>
    Anchor.toml
    Cargo.toml
    programs/gsd-hub/Cargo.toml
    programs/gsd-hub/src/lib.rs
    programs/gsd-hub/src/state/mod.rs
    programs/gsd-hub/src/state/developer.rs
    programs/gsd-hub/src/instructions/mod.rs
    programs/gsd-hub/src/instructions/register.rs
    programs/gsd-hub/src/instructions/update_hash.rs
    programs/gsd-hub/src/errors.rs
    programs/gsd-hub/tests/register.test.ts
  </files>
  <action>
    Create the Anchor workspace and program:

    1. `Cargo.toml` (workspace root): Define workspace members = ["programs/gsd-hub"]. Set resolver = "2".

    2. `Anchor.toml`: Configure for devnet cluster. Set [programs.devnet] with gsd_hub program ID (generate a new keypair with `anchor keys list` or use a placeholder, then update after first `anchor keys sync`). Set wallet to ~/.config/solana/id.json. Set [scripts] test command to use anchor-bankrun.

    3. `programs/gsd-hub/Cargo.toml`: name "gsd-hub", version "0.1.0", edition "2021". Dependencies: anchor-lang = { version = "0.32.1", features = ["init-if-needed"] }.

    4. `programs/gsd-hub/src/errors.rs`: Define `GsdHubError` enum with:
       - `#[msg("Profile already exists")] ProfileAlreadyExists`
       - `#[msg("Unauthorized")] Unauthorized`
       - `#[msg("Invalid profile hash")] InvalidProfileHash`

    5. `programs/gsd-hub/src/state/developer.rs`: Define `DeveloperProfile` struct with `#[account]` and `#[derive(InitSpace)]`:
       - `authority: Pubkey` (32 bytes)
       - `bump: u8` (1 byte)
       - `created_at: i64` (8 bytes)
       - `updated_at: i64` (8 bytes)
       - `profile_hash: [u8; 32]` (32 bytes)
       Total: 8 (discriminator) + 81 = 89 bytes

    6. `programs/gsd-hub/src/state/mod.rs`: Declare and re-export developer module.

    7. `programs/gsd-hub/src/instructions/register.rs`:
       - `RegisterDeveloper` accounts struct with:
         - `developer_profile`: Account<DeveloperProfile> with `init`, `payer = authority`, `space = 8 + DeveloperProfile::INIT_SPACE`, `seeds = [b"developer", authority.key().as_ref()]`, `bump`
         - `authority`: Signer (mut, payer)
         - `system_program`: Program<System>
       - `handler(ctx, profile_hash: [u8; 32])`: Set authority, bump (from ctx.bumps), created_at and updated_at from Clock::get(), profile_hash

    8. `programs/gsd-hub/src/instructions/update_hash.rs`:
       - `UpdateProfileHash` accounts struct with:
         - `developer_profile`: Account<DeveloperProfile> with `mut`, `seeds`, `bump = developer_profile.bump`, `has_one = authority`
         - `authority`: Signer
       - `handler(ctx, new_hash: [u8; 32])`: Update profile_hash and updated_at

    9. `programs/gsd-hub/src/instructions/mod.rs`: Declare and re-export register and update_hash modules.

    10. `programs/gsd-hub/src/lib.rs`:
        - `declare_id!` with program ID
        - `pub mod state; pub mod instructions; pub mod errors;`
        - `#[program] pub mod gsd_hub` with:
          - `register_developer(ctx: Context<RegisterDeveloper>, profile_hash: [u8; 32])`
          - `update_profile_hash(ctx: Context<UpdateProfileHash>, new_hash: [u8; 32])`

    11. `programs/gsd-hub/tests/register.test.ts`: Using anchor-bankrun (startAnchor, BankrunProvider):
        - Test "creates a developer profile PDA": register with test hash, fetch account, verify authority matches, verify profile_hash matches, verify created_at > 0
        - Test "prevents duplicate registration": register twice with same wallet, expect error
        - Test "updates profile hash": register, then update_profile_hash with new hash, verify new hash stored and updated_at changed

    Build the program with `anchor build`. Run tests with `anchor test --skip-local-validator` (bankrun handles the validator). After build, sync the program ID: run `anchor keys list`, update declare_id! in lib.rs and Anchor.toml, rebuild.

    IMPORTANT: Ensure the PDA seeds in the Anchor program EXACTLY match the seeds in packages/utils/src/pda.ts: `[b"developer", authority.key().as_ref()]` on-chain = `[Buffer.from("developer"), wallet.toBuffer()]` in TypeScript.
  </action>
  <verify>
    - `anchor build` compiles without errors
    - `anchor test --skip-local-validator` passes all 3 tests (create, duplicate prevention, update)
    - `anchor keys list` shows the program ID
    - Program ID in lib.rs matches Anchor.toml
  </verify>
  <done>
    Anchor program compiles and all tests pass: developer registration creates a 89-byte PDA, duplicate registration is rejected, and profile hash can be updated by the profile owner. Program ID is synced across lib.rs and Anchor.toml. IDL is generated at target/idl/gsd_hub.json.
  </done>
</task>

</tasks>

<verification>
1. `pnpm install` at root succeeds
2. `anchor build` compiles the program
3. `anchor test --skip-local-validator` passes all tests
4. `packages/utils/src/pda.ts` uses seeds matching the on-chain program seeds
5. IDL exists at `target/idl/gsd_hub.json`
</verification>

<success_criteria>
- Turborepo monorepo with pnpm workspaces resolves all dependencies
- Anchor program deploys to localnet and passes registration + update tests
- Shared packages (@gsd/types, @gsd/utils) export profile types, PDA derivation, and hash computation
- PDA seeds are consistent between on-chain and TypeScript
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-authentication/01-01-SUMMARY.md`
</output>
