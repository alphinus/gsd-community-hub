---
phase: 01-foundation-authentication
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - turbo.json
  - pnpm-workspace.yaml
  - package.json
  - Anchor.toml
  - Cargo.toml
  - rust-toolchain.toml
  - tsconfig.json
  - .gitignore
  - programs/gsd-hub/Cargo.toml
  - programs/gsd-hub/src/lib.rs
  - programs/gsd-hub/src/state/mod.rs
  - programs/gsd-hub/src/state/developer.rs
  - programs/gsd-hub/src/instructions/mod.rs
  - programs/gsd-hub/src/instructions/register.rs
  - programs/gsd-hub/src/instructions/update_hash.rs
  - programs/gsd-hub/src/errors.rs
  - programs/gsd-hub/tests/register.test.ts
  - packages/types/package.json
  - packages/types/tsconfig.json
  - packages/types/src/index.ts
  - packages/types/src/profile.ts
  - packages/types/src/api.ts
  - packages/utils/package.json
  - packages/utils/tsconfig.json
  - packages/utils/src/index.ts
  - packages/utils/src/pda.ts
  - packages/utils/src/hash.ts
autonomous: true

must_haves:
  truths:
    - "Anchor program compiles and deploys to localnet/devnet"
    - "register_developer instruction creates a PDA with correct seeds [b'developer', wallet_pubkey]"
    - "update_profile_hash instruction updates the hash and timestamp on an existing profile PDA"
    - "Only the PDA authority can update their own profile hash"
    - "Shared packages export PDA derivation and hash computation utilities"
  artifacts:
    - path: "programs/gsd-hub/src/lib.rs"
      provides: "Anchor program with register_developer and update_profile_hash instructions"
      contains: "declare_id!"
    - path: "programs/gsd-hub/src/state/developer.rs"
      provides: "DeveloperProfile account struct (authority, bump, created_at, updated_at, profile_hash)"
      contains: "pub struct DeveloperProfile"
    - path: "programs/gsd-hub/src/instructions/register.rs"
      provides: "Developer registration instruction with PDA init"
      contains: "seeds = [b\"developer\""
    - path: "programs/gsd-hub/src/instructions/update_hash.rs"
      provides: "Profile hash update instruction with authority check"
      contains: "has_one = authority"
    - path: "packages/utils/src/pda.ts"
      provides: "getDeveloperProfilePDA function"
      exports: ["getDeveloperProfilePDA"]
    - path: "packages/utils/src/hash.ts"
      provides: "computeProfileHash function"
      exports: ["computeProfileHash"]
    - path: "turbo.json"
      provides: "Turborepo build configuration"
      contains: "pipeline"
  key_links:
    - from: "programs/gsd-hub/src/instructions/register.rs"
      to: "programs/gsd-hub/src/state/developer.rs"
      via: "Account<DeveloperProfile> with init constraint"
      pattern: "Account.*DeveloperProfile"
    - from: "packages/utils/src/pda.ts"
      to: "programs/gsd-hub/src/instructions/register.rs"
      via: "Matching PDA seed derivation [developer, wallet]"
      pattern: "Buffer.from.*developer"
---

<objective>
Scaffold the Turborepo monorepo and build the Anchor on-chain program for the GSD Community Hub.

Purpose: This is the foundation layer. Every subsequent plan depends on this monorepo structure and the deployed Anchor program. The on-chain program defines the developer identity PDA that is the core primitive of the platform -- proving "this wallet registered at this time" with a verifiable off-chain profile hash.

Output: Working monorepo with compilable Anchor program, passing tests, shared TypeScript packages for PDA derivation and profile hashing.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-authentication/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Turborepo monorepo with Anchor program workspace</name>
  <files>
    turbo.json
    pnpm-workspace.yaml
    package.json
    Anchor.toml
    Cargo.toml
    rust-toolchain.toml
    tsconfig.json
    .gitignore
    programs/gsd-hub/Cargo.toml
    programs/gsd-hub/src/lib.rs
    programs/gsd-hub/src/state/mod.rs
    programs/gsd-hub/src/state/developer.rs
    programs/gsd-hub/src/instructions/mod.rs
    programs/gsd-hub/src/instructions/register.rs
    programs/gsd-hub/src/instructions/update_hash.rs
    programs/gsd-hub/src/errors.rs
  </files>
  <action>
    Create the monorepo root with Turborepo and pnpm workspaces:
    - Root package.json with pnpm workspaces pointing to apps/*, packages/*, programs/*
    - pnpm-workspace.yaml listing apps/*, packages/*
    - turbo.json with pipeline for build, test, lint, dev tasks
    - Root tsconfig.json as base config for all TS packages
    - rust-toolchain.toml pinning Rust to 1.91.1 (stable channel)
    - .gitignore covering node_modules, target, .next, .env*.local, dist

    Create the Anchor program (programs/gsd-hub/):
    - Cargo.toml with anchor-lang 0.32.1 dependency
    - Anchor.toml configured for devnet with program keypair path and test command
    - Root Cargo.toml as workspace including programs/gsd-hub

    Implement the Anchor program:

    programs/gsd-hub/src/state/developer.rs:
    - DeveloperProfile struct with #[account] and #[derive(InitSpace)]
    - Fields: authority (Pubkey, 32 bytes), bump (u8, 1 byte), created_at (i64, 8 bytes), updated_at (i64, 8 bytes), profile_hash ([u8; 32], 32 bytes)
    - Total: 8 (discriminator) + 81 = 89 bytes

    programs/gsd-hub/src/instructions/register.rs:
    - RegisterDeveloper accounts struct with:
      - developer_profile: init, payer = authority, space = 8 + DeveloperProfile::INIT_SPACE, seeds = [b"developer", authority.key().as_ref()], bump
      - authority: Signer (mut for payer)
      - system_program: Program<System>
    - handler function: sets authority, bump (ctx.bumps.developer_profile), created_at/updated_at from Clock, profile_hash from parameter

    programs/gsd-hub/src/instructions/update_hash.rs:
    - UpdateProfileHash accounts struct with:
      - developer_profile: mut, seeds = [b"developer", authority.key().as_ref()], bump = developer_profile.bump, has_one = authority
      - authority: Signer
    - handler function: updates profile_hash and updated_at timestamp

    programs/gsd-hub/src/errors.rs:
    - GsdHubError enum with #[error_code] for future custom errors (start with Unauthorized variant)

    programs/gsd-hub/src/lib.rs:
    - declare_id! with a placeholder program ID (will be replaced after first build/deploy)
    - pub mod state, instructions, errors
    - #[program] mod gsd_hub with register_developer and update_profile_hash public functions delegating to instruction handlers

    Run `anchor build` to compile. After first build, extract the generated program ID from target/deploy/gsd_hub-keypair.json using `solana address -k target/deploy/gsd_hub-keypair.json`, then update declare_id! in lib.rs and [programs.gsd_hub] in Anchor.toml with the actual program ID. Run `anchor build` again to confirm.
  </action>
  <verify>
    `anchor build` completes without errors. The IDL is generated at target/idl/gsd_hub.json and contains both register_developer and update_profile_hash instructions.
  </verify>
  <done>
    Anchor program compiles successfully with correct DeveloperProfile struct (89 bytes), register_developer instruction (PDA init with seeds), update_profile_hash instruction (authority-gated), and generated IDL.
  </done>
</task>

<task type="auto">
  <name>Task 2: Shared TypeScript packages and Anchor program tests</name>
  <files>
    packages/types/package.json
    packages/types/tsconfig.json
    packages/types/src/index.ts
    packages/types/src/profile.ts
    packages/types/src/api.ts
    packages/utils/package.json
    packages/utils/tsconfig.json
    packages/utils/src/index.ts
    packages/utils/src/pda.ts
    packages/utils/src/hash.ts
    programs/gsd-hub/tests/register.test.ts
  </files>
  <action>
    Create packages/types/:
    - package.json with name "@gsd-hub/types", main/types pointing to src/index.ts
    - tsconfig.json extending root tsconfig
    - src/profile.ts: TypeScript types for developer profile:
      - DeveloperProfile (walletAddress, displayName, bio, avatarUrl, githubUrl, twitterUrl, websiteUrl)
      - CreateProfileInput (displayName required, bio required, optional links)
      - UpdateProfileInput (all fields optional, partial update)
    - src/api.ts: API response types:
      - ApiResponse<T> generic wrapper with success/error variants
      - ProfileResponse, DirectoryResponse (paginated list with total count)
    - src/index.ts: re-export all types

    Create packages/utils/:
    - package.json with name "@gsd-hub/utils", dependencies on @solana/web3.js@1
    - tsconfig.json extending root tsconfig
    - src/pda.ts: getDeveloperProfilePDA(wallet: PublicKey, programId: PublicKey) -> [PublicKey, number] using PublicKey.findProgramAddressSync with seeds [Buffer.from("developer"), wallet.toBuffer()]
    - src/hash.ts: computeProfileHash(profile: { displayName: string, bio: string, githubUrl?: string, twitterUrl?: string, websiteUrl?: string }) -> Promise<Uint8Array> using SHA-256 via crypto.subtle.digest with deterministic JSON serialization (sorted keys, undefined values excluded)
    - src/index.ts: re-export all utilities

    Create Anchor program tests (programs/gsd-hub/tests/register.test.ts):
    Install test dependencies: solana-bankrun, anchor-bankrun in the root or a test workspace.

    Write tests using anchor-bankrun (startAnchor + BankrunProvider):
    1. "creates a developer profile PDA" -- call registerDeveloper with a test hash, fetch account, verify authority matches, bump is stored, created_at > 0, profile_hash matches input
    2. "rejects duplicate registration" -- register once, try again, expect error (PDA already exists)
    3. "updates profile hash" -- register, then call updateProfileHash with new hash, fetch account, verify profile_hash changed and updated_at > created_at
    4. "rejects unauthorized hash update" -- register as wallet A, try updateProfileHash with wallet B as signer, expect error

    Run tests with `anchor test` (or the configured test command in Anchor.toml).

    NOTE: If anchor-bankrun/solana-bankrun have compatibility issues with the current Anchor version, fall back to using anchor test with a local validator (anchor test --skip-local-validator with solana-test-validator running separately, or the default anchor test flow). Document whichever approach works.
  </action>
  <verify>
    `pnpm install` succeeds at root. TypeScript packages compile without errors (`pnpm --filter @gsd-hub/types build` and `pnpm --filter @gsd-hub/utils build` -- or tsc --noEmit if no build script). All 4 Anchor tests pass.
  </verify>
  <done>
    Shared packages export getDeveloperProfilePDA and computeProfileHash with correct types. All 4 Anchor program tests pass: registration creates correct PDA, duplicates rejected, hash updates work, unauthorized updates rejected.
  </done>
</task>

</tasks>

<verification>
- `anchor build` produces target/idl/gsd_hub.json with both instructions
- `anchor test` (or equivalent) passes all 4 test cases
- `pnpm install` resolves all workspace dependencies
- packages/utils/src/pda.ts uses seeds matching the Anchor program: [b"developer", wallet]
- DeveloperProfile struct is exactly 89 bytes (8 discriminator + 81 data)
</verification>

<success_criteria>
- Monorepo structure matches research recommendation (apps/, programs/, packages/)
- Anchor program compiles and tests pass on localnet
- IDL generated with register_developer and update_profile_hash instructions
- Shared types and utils packages are importable by future web app
- PDA derivation in TypeScript matches Anchor program seeds exactly
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-authentication/01-01-SUMMARY.md`
</output>
