---
phase: 01-foundation-authentication
plan: 04
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - apps/web/app/(public)/transparency/page.tsx
  - apps/web/components/transparency/multisig-card.tsx
  - apps/web/components/transparency/changelog-list.tsx
  - apps/web/components/transparency/program-info.tsx
  - apps/web/app/api/transparency/route.ts
  - apps/web/app/api/transparency/changelog/route.ts
  - scripts/setup-multisig.ts
  - scripts/log-upgrade.ts
autonomous: true

must_haves:
  truths:
    - "Anyone can view the /transparency page showing multisig details, program info, and upgrade changelog without connecting a wallet"
    - "Multisig address, member addresses (labeled), and threshold (3-of-5) are displayed and link to Solana Explorer"
    - "Program upgrade changelog shows each upgrade with description, signers, and on-chain transaction link"
    - "Squads multisig setup script exists and can create a 3-of-5 multisig on devnet"
  artifacts:
    - path: "apps/web/app/(public)/transparency/page.tsx"
      provides: "Public transparency page with multisig, program info, and changelog"
      contains: "MultisigCard"
    - path: "apps/web/components/transparency/multisig-card.tsx"
      provides: "Card displaying multisig address, members, threshold"
      contains: "multisig"
    - path: "apps/web/components/transparency/changelog-list.tsx"
      provides: "List of program upgrade entries from database"
      contains: "ProgramUpgrade"
    - path: "scripts/setup-multisig.ts"
      provides: "CLI script to create Squads v4 multisig on devnet"
      contains: "multisigCreateV2"
    - path: "scripts/log-upgrade.ts"
      provides: "CLI script to log a program upgrade to the database"
      contains: "ProgramUpgrade"
  key_links:
    - from: "apps/web/app/(public)/transparency/page.tsx"
      to: "apps/web/app/api/transparency/route.ts"
      via: "Server-side data fetch for multisig info"
      pattern: "multisig|program"
    - from: "apps/web/components/transparency/changelog-list.tsx"
      to: "apps/web/app/api/transparency/changelog/route.ts"
      via: "Fetches upgrade history"
      pattern: "changelog|ProgramUpgrade"
    - from: "scripts/setup-multisig.ts"
      to: "@sqds/multisig"
      via: "Creates multisig via Squads SDK"
      pattern: "multisig\\.rpc\\.multisigCreateV2"
---

<objective>
Build the transparency page and multisig tooling -- the trust infrastructure that shows skeptics the platform is secure, transparent, and community-governed. Every program upgrade is logged with what changed, who signed, and the on-chain transaction.

Purpose: For a community with rug fear, the transparency page is the single most important trust signal after open source code (per research). This directly implements the locked "public changelog" decision and the "proof visible" trust strategy. The multisig setup script ensures program upgrade authority is never a single wallet (TRSY-01, TRSY-04).
Output: Public /transparency page, Squads multisig creation script, upgrade logging script.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-authentication/01-RESEARCH.md
@.planning/phases/01-foundation-authentication/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build transparency page with multisig details, program info, and upgrade changelog</name>
  <files>
    apps/web/app/(public)/transparency/page.tsx
    apps/web/components/transparency/multisig-card.tsx
    apps/web/components/transparency/changelog-list.tsx
    apps/web/components/transparency/program-info.tsx
    apps/web/app/api/transparency/route.ts
    apps/web/app/api/transparency/changelog/route.ts
  </files>
  <action>
    Build the public transparency page and supporting API:

    1. `app/api/transparency/route.ts`: GET endpoint (public, no auth):
       - Return transparency data: multisig address, member list with labels (role: "Core Team" or "Community"), threshold, program IDs, network, deployment timestamps
       - For Phase 1 (pre-mainnet), this data can be stored in a config file or environment variables. The key is that it's surfaced publicly.
       - Structure: { multisig: { address, threshold, members: [{ address, label, role }] }, programs: [{ name, id, network, deployedAt }], repository: { url, license }, tokenInfo: { mintAuthority: "revoked/multisig/active", freezeAuthority: "none/address", metadataAuthority: "multisig/address" } }
       - The tokenInfo section implements the "Anti-Rug Standard" concept from Claude's Discretion: show mint authority status, freeze authority, metadata authority -- all verifiable on-chain

    2. `app/api/transparency/changelog/route.ts`: GET endpoint (public, no auth):
       - Query ProgramUpgrade model from database, order by createdAt descending
       - Return { upgrades: ProgramUpgrade[], total: number }
       - Each upgrade: { id, programId, version, description, signers, transactionSignature, multisigAddress, createdAt }
       - Pagination support via ?page=1&limit=20

    3. `components/transparency/multisig-card.tsx`: Card component:
       - Title: "Program Governance"
       - Show threshold prominently: "3 of 5 signatures required"
       - Per locked decision: "3 core team + 2 trusted community members"
       - List each member with their address (truncated with copy button), role label
       - Each address links to Solana Explorer (devnet or mainnet based on NEXT_PUBLIC_NETWORK)
       - Multisig address links to Squads UI (https://v4.squads.so/squad/ADDRESS)
       - Visual: use a grid/list with role badges

    4. `components/transparency/program-info.tsx`: Card component:
       - Title: "On-Chain Programs"
       - List each deployed program: name, program ID (truncated with copy, links to Explorer), network badge (devnet/mainnet), upgrade authority (should show multisig address)
       - Link to source code repository (GitHub)
       - "Anti-Rug Standard" section (framing per Claude's Discretion):
         - Mint authority status for $GSD token
         - Freeze authority status
         - Metadata authority status
         - All verifiable: each item links to the relevant Solana Explorer page
       - Framing: straightforward facts, no defensive language (per locked decision "no defensive posture")

    5. `components/transparency/changelog-list.tsx`: "use client" component:
       - Fetches from /api/transparency/changelog
       - Timeline/list view of all program upgrades
       - Each entry shows: version, description of what changed, date, list of signers (truncated addresses), transaction signature (links to Solana Explorer tx)
       - Empty state: "No program upgrades yet. Initial deployment pending." (appropriate for early devnet phase)
       - Use TanStack Query for data fetching

    6. `app/(public)/transparency/page.tsx`: Server Component page:
       - Title: "Transparency" with subtitle "Everything is on-chain. Everything is verifiable."
       - Render MultisigCard, ProgramInfo, and ChangelogList
       - Metadata for SEO: title "Transparency | GSD Community Hub"
       - No wallet connection required
       - Tone: confident, factual. Per locked decisions: "work first, proof visible", "no defensive posture", "confidence, not desperation". Don't say "we promise we won't rug" -- just show the data.

    Use shadcn/ui Card, Badge, Button components. Consistent dark theme. All external links open in new tab. All Solana addresses have copy-to-clipboard functionality.

    For initial setup, the multisig address and member data can be placeholder values that get updated once the multisig script (Task 2) is run. Use environment variables: NEXT_PUBLIC_MULTISIG_ADDRESS, or a transparency-config.ts file.
  </action>
  <verify>
    - Dev server running
    - Visit /transparency without wallet connection -- page renders
    - Multisig card shows 3-of-5 threshold with member list
    - Program info shows program ID linking to Explorer
    - Changelog section renders (empty state is fine)
    - All Solana Explorer links are correct format (devnet)
    - No defensive/apologetic language in the UI
    - Copy-to-clipboard works on addresses
  </verify>
  <done>
    Public transparency page at /transparency showing: multisig governance details (3-of-5, member addresses with roles), program information with Anti-Rug Standard indicators (mint/freeze/metadata authority status), and program upgrade changelog. All data links to Solana Explorer for independent verification. Accessible without wallet connection.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Squads multisig setup script and upgrade logging utility</name>
  <files>
    scripts/setup-multisig.ts
    scripts/log-upgrade.ts
  </files>
  <action>
    Create CLI scripts for multisig management:

    1. `scripts/setup-multisig.ts`: Node.js script using @sqds/multisig SDK:
       - Reads signer public keys from command line args or a JSON config file
       - Creates a Squads v4 multisig with:
         - 5 members (configurable, default expects 5 pubkey args)
         - Threshold: 3 (configurable via --threshold flag)
         - All members get Permissions.all()
       - Connects to the network specified by SOLANA_RPC_URL env var (or devnet default)
       - Uses a local keypair (from SOLANA_KEYPAIR_PATH or ~/.config/solana/id.json) as the creator/fee payer
       - Outputs: multisig PDA address, vault PDA address, transaction signature
       - Includes instructions to transfer program upgrade authority to the multisig vault
       - Usage: `npx tsx scripts/setup-multisig.ts <pubkey1> <pubkey2> <pubkey3> <pubkey4> <pubkey5>`
       - For devnet development: supports --dev flag that creates a 2-of-3 multisig for faster iteration (per research recommendation)
       - Log all output to console with clear labels

    2. `scripts/log-upgrade.ts`: Node.js script to record a program upgrade in the database:
       - Accepts: --program-id, --version, --description, --signers (comma-separated), --tx (transaction signature), --multisig (multisig address)
       - Connects to database via DATABASE_URL env var
       - Creates a ProgramUpgrade record in the database
       - This is manually run after each program upgrade to maintain the public changelog (per locked decision)
       - Usage: `npx tsx scripts/log-upgrade.ts --program-id GSD... --version 0.1.0 --description "Initial deployment" --signers "addr1,addr2,addr3" --tx "5abc..." --multisig "SQD..."`
       - Validates all required fields before inserting
       - Outputs confirmation with the created record

    Both scripts should have clear usage instructions when run without args (--help). Use minimal dependencies (just @sqds/multisig, @solana/web3.js, @prisma/client).

    IMPORTANT: These scripts are operational tools for the project maintainer, not end-user features. They enable the locked decision that "every program upgrade is logged with what changed, who signed, and on-chain tx."
  </action>
  <verify>
    - `npx tsx scripts/setup-multisig.ts --help` shows usage instructions
    - `npx tsx scripts/setup-multisig.ts --dev <pubkey1> <pubkey2> <pubkey3>` creates a 2-of-3 devnet multisig (requires devnet SOL)
    - `npx tsx scripts/log-upgrade.ts --help` shows usage instructions
    - `npx tsx scripts/log-upgrade.ts --program-id test --version 0.1.0 --description "Test" --signers "addr1" --tx "sig1" --multisig "msig1"` creates a database record
    - After log-upgrade, visit /transparency -- the changelog shows the logged upgrade
  </verify>
  <done>
    Two operational scripts: setup-multisig.ts creates a Squads v4 multisig (3-of-5 for production, 2-of-3 for dev) and outputs the multisig/vault addresses. log-upgrade.ts records program upgrades to the database for the public changelog. Together they implement TRSY-01 (multisig treasury), TRSY-04 (multisig upgrade authority), and the locked "public changelog" decision.
  </done>
</task>

</tasks>

<verification>
1. /transparency page loads without wallet connection
2. Multisig card displays correct governance structure (3-of-5, member roles)
3. Program info shows deployed program with Explorer links
4. Changelog displays logged upgrades with transaction links
5. setup-multisig.ts can create a devnet multisig
6. log-upgrade.ts records upgrades that appear on the transparency page
7. No defensive/apologetic language -- confident, factual tone
</verification>

<success_criteria>
- Public transparency page accessible without authentication (INFR-03)
- Multisig details visible: address, members (labeled core team / community), threshold (TRSY-01, TRSY-04)
- Program upgrade changelog shows what changed, who signed, on-chain tx link (locked "public changelog" decision)
- Anti-Rug Standard indicators: mint/freeze/metadata authority status displayed
- Squads multisig creation script functional on devnet
- Treasury transactions visible on transparency page (TRSY-02 foundation)
- Tone matches locked decisions: work first proof visible, no defensive posture, confidence not desperation
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-authentication/01-04-SUMMARY.md`
</output>
