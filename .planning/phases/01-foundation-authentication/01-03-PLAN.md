---
phase: 01-foundation-authentication
plan: 03
type: execute
wave: 3
depends_on: ["01-01", "01-02"]
files_modified:
  - apps/web/app/(auth)/profile/edit/page.tsx
  - apps/web/app/(public)/profile/[wallet]/page.tsx
  - apps/web/app/(public)/explore/page.tsx
  - apps/web/app/api/profile/route.ts
  - apps/web/app/api/profile/[wallet]/route.ts
  - apps/web/app/api/directory/route.ts
  - apps/web/components/profile/profile-form.tsx
  - apps/web/components/profile/profile-card.tsx
  - apps/web/components/profile/profile-header.tsx
  - apps/web/components/profile/directory-grid.tsx
autonomous: false

must_haves:
  truths:
    - "Authenticated user can create a developer profile with display name, bio, and optional links"
    - "Creating a profile registers the developer PDA on-chain with a profile hash"
    - "User can edit their profile and the on-chain hash is updated"
    - "Anyone can view a developer's public profile page by wallet address without connecting a wallet"
    - "Anyone can browse the developer directory showing all registered members with total count"
  artifacts:
    - path: "apps/web/app/api/profile/route.ts"
      provides: "POST (create) and PUT (update) profile endpoints"
      exports: ["POST", "PUT"]
    - path: "apps/web/app/api/profile/[wallet]/route.ts"
      provides: "GET profile by wallet address"
      exports: ["GET"]
    - path: "apps/web/app/api/directory/route.ts"
      provides: "GET developer directory listing with pagination"
      exports: ["GET"]
    - path: "apps/web/app/(auth)/profile/edit/page.tsx"
      provides: "Profile create/edit form"
      contains: "ProfileForm"
    - path: "apps/web/app/(public)/profile/[wallet]/page.tsx"
      provides: "Public profile view page"
      contains: "ProfileHeader"
    - path: "apps/web/app/(public)/explore/page.tsx"
      provides: "Developer directory page with grid of profile cards"
      contains: "DirectoryGrid"
  key_links:
    - from: "apps/web/components/profile/profile-form.tsx"
      to: "apps/web/app/api/profile/route.ts"
      via: "Form submission POSTs/PUTs profile data"
      pattern: "fetch.*api/profile"
    - from: "apps/web/components/profile/profile-form.tsx"
      to: "@gsd/utils computeProfileHash"
      via: "Computes SHA-256 hash of profile data before on-chain registration"
      pattern: "computeProfileHash"
    - from: "apps/web/components/profile/profile-form.tsx"
      to: "programs/gsd-hub register_developer"
      via: "Sends on-chain transaction to register PDA with profile hash"
      pattern: "registerDeveloper|register_developer"
    - from: "apps/web/app/(public)/explore/page.tsx"
      to: "apps/web/app/api/directory/route.ts"
      via: "Fetches paginated developer list"
      pattern: "api/directory"
---

<objective>
Build the developer profile system -- create, edit, view profiles and browse the public directory. This is where "creating a profile = joining the GSD community" (locked decision) becomes real. The directory is visible proof the community exists and is growing.

Purpose: Profiles are the foundation of identity in the GSD Community Hub. Without profiles, there's nothing to show on-chain, no community to display, and no base for contribution tracking (Phase 2). The public directory directly serves the "proof visible" trust strategy.
Output: Working profile CRUD with on-chain PDA registration, public profile pages, and browsable developer directory.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-authentication/01-RESEARCH.md
@.planning/phases/01-foundation-authentication/01-01-SUMMARY.md
@.planning/phases/01-foundation-authentication/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build profile API endpoints and on-chain registration flow</name>
  <files>
    apps/web/app/api/profile/route.ts
    apps/web/app/api/profile/[wallet]/route.ts
    apps/web/app/api/directory/route.ts
  </files>
  <action>
    Create the profile API layer:

    1. `app/api/profile/route.ts`:
       - POST handler (create profile):
         - Verify session via auth() -- reject 401 if not authenticated
         - Parse body: { displayName: string, bio: string, githubUrl?: string, twitterUrl?: string, websiteUrl?: string }
         - Validate: displayName required (3-50 chars), bio required (1-500 chars), URLs validated if present (must start with https://)
         - Check if profile already exists for this wallet -- return 409 if duplicate
         - Create User record in PostgreSQL via Prisma
         - Return 201 with the created profile
         - NOTE: The on-chain PDA registration happens client-side (the wallet signs the transaction). The API only handles the off-chain data. The client will call this API AND send the on-chain transaction, then update the profile with the PDA address.

       - PUT handler (update profile):
         - Verify session via auth() -- reject 401 if not authenticated
         - Parse body: partial profile fields (any of displayName, bio, githubUrl, twitterUrl, websiteUrl)
         - Same validation rules as POST
         - Update User record in PostgreSQL
         - Compute new profileHash from updated data using computeProfileHash from @gsd/utils
         - Update profileHash in database
         - Return 200 with updated profile
         - NOTE: Client will also send update_profile_hash transaction on-chain after successful API update

    2. `app/api/profile/[wallet]/route.ts`:
       - GET handler: Look up User by walletAddress. Return 404 if not found. Return profile data (public -- no auth required). Include: walletAddress, displayName, bio, avatarUrl, githubUrl, twitterUrl, websiteUrl, onChainPda, createdAt. Do NOT include internal id.

    3. `app/api/directory/route.ts`:
       - GET handler: Query all Users with profiles (where displayName is not null). Support pagination via ?page=1&limit=20 query params. Return { developers: User[], total: number, page: number, totalPages: number }. Order by createdAt descending (newest first). No auth required -- this is public.

    All endpoints return JSON with proper error shapes: { error: string } on failure.
  </action>
  <verify>
    - Start dev server, use curl or similar to test:
    - `GET /api/directory` returns empty list with total: 0
    - `POST /api/profile` without auth returns 401
    - `GET /api/profile/SomeWalletAddress` returns 404 for non-existent profile
    - TypeScript compilation: `npx tsc --noEmit` passes in apps/web
  </verify>
  <done>
    Three API endpoints working: POST/PUT /api/profile (authenticated, creates/updates off-chain profile), GET /api/profile/[wallet] (public, returns profile by wallet), GET /api/directory (public, paginated list of all developers with total count).
  </done>
</task>

<task type="auto">
  <name>Task 2: Build profile UI -- create/edit form, public profile page, and developer directory</name>
  <files>
    apps/web/app/(auth)/profile/edit/page.tsx
    apps/web/app/(public)/profile/[wallet]/page.tsx
    apps/web/app/(public)/explore/page.tsx
    apps/web/components/profile/profile-form.tsx
    apps/web/components/profile/profile-card.tsx
    apps/web/components/profile/profile-header.tsx
    apps/web/components/profile/directory-grid.tsx
  </files>
  <action>
    Build the profile UI components and pages:

    1. `components/profile/profile-form.tsx`: "use client" form component:
       - Fields: displayName (input, required, max 50), bio (textarea, required, max 500), githubUrl (input, optional), twitterUrl (input, optional), websiteUrl (input, optional)
       - Character counter for bio
       - On submit (create flow):
         a. POST profile data to /api/profile
         b. Compute profile hash using computeProfileHash from @gsd/utils
         c. Send register_developer transaction on-chain via Anchor program client (from useGsdProgram hook). Pass the profile hash bytes. This creates the PDA.
         d. After on-chain tx confirms, PUT to /api/profile to update the onChainPda field with the PDA address
         e. Show success toast and redirect to the user's public profile
       - On submit (edit flow):
         a. PUT profile data to /api/profile
         b. Compute new profile hash
         c. Send update_profile_hash transaction on-chain
         d. Show success toast
       - Handle errors: show toast on API failure, show toast on transaction failure (with "try again" option), handle wallet not connected
       - Loading states during transaction signing and confirmation
       - "Join the Movement" framing for create mode (per locked decision: profile = joining the community)

    2. `components/profile/profile-header.tsx`: Profile display component:
       - Avatar (generated from wallet address if no custom avatar -- use a gradient or identicon)
       - Display name prominently
       - Bio
       - Wallet address (truncated with copy button)
       - External links as icons (GitHub, Twitter/X, Website) -- open in new tab
       - "Member since" date
       - On-chain verification badge: if onChainPda exists, show a small "Verified on-chain" indicator with link to Solana Explorer (devnet)
       - If viewing own profile: "Edit Profile" button

    3. `components/profile/profile-card.tsx`: Compact card for directory grid:
       - Avatar, display name, truncated wallet address, member since date
       - Click navigates to /profile/[wallet]
       - Subtle hover effect
       - On-chain verified indicator (small dot/icon)

    4. `components/profile/directory-grid.tsx`: "use client" directory component:
       - Fetches from /api/directory with TanStack Query (useQuery)
       - Responsive grid: 1 col on mobile, 2 on md, 3 on lg
       - Total member count displayed prominently at top ("X builders have joined the movement")
       - Pagination controls (previous/next) or infinite scroll
       - Empty state: "Be the first to join. Connect your wallet to get started."
       - Loading skeleton while fetching

    5. `app/(auth)/profile/edit/page.tsx`: Protected page (proxy.ts guards /auth/*):
       - Fetch current profile if exists (for edit mode)
       - Render ProfileForm in create or edit mode
       - Page title: "Join the Movement" (create) or "Edit Profile" (edit)

    6. `app/(public)/profile/[wallet]/page.tsx`: Public profile page (Server Component where possible):
       - Fetch profile server-side from database (no API call needed -- direct Prisma query in Server Component)
       - 404 page if profile not found
       - Render ProfileHeader
       - Metadata for SEO: title = "{displayName} | GSD Community Hub", description = bio truncated
       - No wallet connection required to view

    7. `app/(public)/explore/page.tsx`: Public developer directory page:
       - Page title: "Explore Builders"
       - Server-side initial data load (first page) for SEO
       - Client-side pagination via DirectoryGrid component
       - "Join the Movement" CTA for non-authenticated visitors

    Use shadcn/ui components throughout: Card, Button, Input, Label, Avatar, Toast (via sonner). Style with Tailwind CSS 4. Ensure responsive design. Dark theme consistent with the landing page.

    IMPORTANT: No token balance display, no $GSD references in the UI (INFR-03: token-optional Phase 1). The profile is about developer identity and community, not token holdings.
  </action>
  <verify>
    - Dev server running, authenticate via SIWS
    - Navigate to /profile/edit -- form renders with "Join the Movement" header
    - Fill in displayName and bio, submit -- profile created in DB, on-chain transaction sent (requires devnet SOL in wallet), redirected to public profile page
    - Visit /profile/[wallet] while logged out -- profile displays without authentication
    - Visit /explore -- directory shows the registered profile with member count
    - Edit profile: navigate to /profile/edit again, form pre-filled, update bio, submit -- on-chain hash updated
    - Mobile responsive: directory grid collapses to single column
  </verify>
  <done>
    Complete profile system working: authenticated users can create a profile (which registers on-chain PDA and joins the community), edit their profile (updates on-chain hash), view any developer's public profile page, and browse the developer directory showing all registered members with total count. All public pages accessible without wallet connection.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify complete auth + profile flow</name>
  <what-built>Full authentication and profile system: wallet connect, SIWS auth, session persistence, profile create/edit with on-chain PDA, public profile pages, developer directory.</what-built>
  <how-to-verify>
    1. Visit http://localhost:3000 -- landing page loads without wallet
    2. Click wallet connect -- Phantom/Solflare/Backpack modal appears
    3. Connect wallet and approve SIWS message -- session established
    4. Refresh browser -- session persists (still authenticated)
    5. Navigate to /profile/edit -- "Join the Movement" form appears
    6. Create profile with name and bio -- confirm on-chain transaction in wallet
    7. After success, redirected to public profile page
    8. Open incognito window, visit /profile/[your-wallet] -- profile visible without authentication
    9. Visit /explore -- your profile appears in directory with "1 builder" count
    10. Back in authenticated window: edit profile, change bio, confirm on-chain hash update
    11. Disconnect wallet -- session cleared, returned to landing page

    Check specifically:
    - No $GSD token references anywhere in the UI
    - Dark professional theme (not memecoin aesthetic)
    - Mobile responsive on /explore page
    - On-chain verification indicator on profile (links to Solana Explorer devnet)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. Profile create flow: form -> API -> on-chain PDA -> redirect to profile
2. Profile edit flow: form -> API -> on-chain hash update -> success toast
3. Public profile page: accessible without auth, shows all profile data
4. Developer directory: paginated, shows total count, publicly accessible
5. No token references in UI (INFR-03 compliance)
6. On-chain PDA has correct profile hash matching off-chain data
</verification>

<success_criteria>
- Authenticated user can create profile with on-chain PDA registration (AUTH-04, AUTH-05)
- Anyone can view developer profile pages (AUTH-06 partial -- contribution history comes in Phase 2)
- Developer directory shows all members with total count ("profile as movement" locked decision)
- Profile hash on-chain matches SHA-256 of off-chain data (content hash anchoring pattern)
- All public pages accessible without wallet connection (INFR-03)
- Human checkpoint approved
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-authentication/01-03-SUMMARY.md`
</output>
