---
phase: 06-advanced-governance
plan: 06
type: execute
wave: 4
depends_on: ["06-01", "06-02", "06-04", "06-05"]
files_modified:
  - apps/web/components/governance/DelegationPanel.tsx
  - apps/web/components/governance/DelegateCard.tsx
  - apps/web/components/governance/DelegateDirectory.tsx
  - apps/web/components/governance/QuadraticVoteDisplay.tsx
  - apps/web/components/governance/HumanVerificationBadge.tsx
  - apps/web/components/governance/DecayedScoreDisplay.tsx
  - apps/web/app/(auth)/governance/delegate/page.tsx
  - apps/web/app/(public)/governance/delegates/page.tsx
  - apps/web/app/(public)/governance/dashboard/page.tsx
  - apps/web/lib/identity/civic.ts
autonomous: true

must_haves:
  truths:
    - "User can delegate their voting power to another wallet via the delegation panel"
    - "User can revoke their delegation and regain direct voting ability"
    - "Delegate directory shows all active delegates with their total delegated power"
    - "Voting UI shows quadratic weight (sqrt) when quadratic voting is enabled"
    - "Human verification badge indicates Civic Pass status on voter profiles"
    - "Profile shows original vs decayed contribution score when decay is active"
    - "Governance dashboard displays delegation summary and quadratic voting status"
  artifacts:
    - path: "apps/web/components/governance/DelegationPanel.tsx"
      provides: "Delegate/revoke UI with wallet input and confirmation"
      contains: "DelegationPanel"
    - path: "apps/web/components/governance/QuadraticVoteDisplay.tsx"
      provides: "Shows sqrt(tokens) = vote weight calculation"
      contains: "QuadraticVoteDisplay"
    - path: "apps/web/components/governance/HumanVerificationBadge.tsx"
      provides: "Verified human indicator badge"
      contains: "HumanVerificationBadge"
    - path: "apps/web/components/governance/DecayedScoreDisplay.tsx"
      provides: "Original vs decayed score comparison"
      contains: "DecayedScoreDisplay"
    - path: "apps/web/app/(auth)/governance/delegate/page.tsx"
      provides: "Delegation management page (authenticated)"
      contains: "DelegationPanel"
    - path: "apps/web/app/(public)/governance/delegates/page.tsx"
      provides: "Public delegate directory page"
      contains: "DelegateDirectory"
    - path: "apps/web/lib/identity/civic.ts"
      provides: "Civic Pass gateway configuration"
      contains: "CIVIC_GATEKEEPER_NETWORKS"
  key_links:
    - from: "apps/web/components/governance/DelegationPanel.tsx"
      to: "/api/governance/delegate"
      via: "TanStack Query fetch"
      pattern: "api/governance/delegate"
    - from: "apps/web/components/governance/DecayedScoreDisplay.tsx"
      to: "/api/governance/decay"
      via: "TanStack Query fetch"
      pattern: "api/governance/decay"
    - from: "apps/web/components/governance/HumanVerificationBadge.tsx"
      to: "/api/governance/human-verification"
      via: "TanStack Query fetch"
      pattern: "api/governance/human-verification"
---

<objective>
Build the frontend components for Civic Pass identity verification, vote delegation management, quadratic vote weight display, and reputation decay score visualization.

Purpose: Users need to see, understand, and interact with the new governance mechanics. Delegation must be accessible, quadratic weight must be transparent, and decay must be clearly communicated to prevent confusion.
Output: 6 new components, 2 new pages, Civic Pass configuration, and integration with existing governance dashboard.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/06-advanced-governance/06-RESEARCH.md
@.planning/phases/06-advanced-governance/06-01-SUMMARY.md
@.planning/phases/06-advanced-governance/06-04-SUMMARY.md
@.planning/phases/06-advanced-governance/06-05-SUMMARY.md

# Key source files
@apps/web/components/governance/VotePanel.tsx
@apps/web/components/governance/VotingPowerDisplay.tsx
@apps/web/components/governance/DepositPanel.tsx
@apps/web/app/(auth)/governance/deposit/page.tsx
@apps/web/app/(public)/governance/page.tsx
@apps/web/app/(public)/governance/dashboard/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Civic Pass config, DelegationPanel, DelegateCard, DelegateDirectory, and delegation pages</name>
  <files>
    apps/web/lib/identity/civic.ts
    apps/web/components/governance/DelegationPanel.tsx
    apps/web/components/governance/DelegateCard.tsx
    apps/web/components/governance/DelegateDirectory.tsx
    apps/web/app/(auth)/governance/delegate/page.tsx
    apps/web/app/(public)/governance/delegates/page.tsx
  </files>
  <action>
**lib/identity/civic.ts** -- Create Civic Pass configuration:
- Export `CIVIC_GATEKEEPER_NETWORKS` object with `LIVENESS` and `ID_VERIFICATION` PublicKey values (from research -- verify current addresses at implementation time using Civic docs)
- Export `DEFAULT_GATEKEEPER_NETWORK` set to LIVENESS
- Export `CIVIC_GATEWAY_PROGRAM_ID` (the gateway program address on Solana)
- NOTE: Do NOT import `@civic/solana-gateway-react` here. That's a React component used in pages, not a config file.

**DelegationPanel.tsx** -- Client component for delegation management:
- Shows current delegation status: "You are delegating X tokens to [delegate address]" or "No active delegation"
- "Delegate" form: wallet address input (validate as base58 Solana address) + "Delegate Voting Power" button
- "Revoke" button when delegation is active
- On-chain transaction flow:
  - Delegate: Build and send `delegate_vote` instruction via Anchor program
  - Revoke: Build and send `revoke_delegation` instruction via Anchor program
- Use `useGsdProgram()` hook (existing pattern) for Anchor program access
- Use `useWallet()` for signer
- Refresh delegation status from `/api/governance/delegate?wallet=X` via TanStack Query after tx confirms
- Show transaction status with sonner toasts (existing pattern)
- Display effective round: "Delegation will be active starting Round X"

**DelegateCard.tsx** -- Presentational component for delegate in directory:
- Props: `{ delegate: string, delegatorCount: number, totalDelegated: string, isVerified: boolean }`
- Card layout: truncated wallet address, delegator count badge, total delegated tokens (formatted), verification badge
- Link to delegate's profile page
- Use existing Card component pattern (from 01-04)

**DelegateDirectory.tsx** -- Client component for browsing delegates:
- Fetches from `/api/governance/delegate` (or a delegates endpoint that lists all active delegates)
- Actually, use `/api/governance/analytics` which returns `delegationStats.topDelegates`
- Grid layout of DelegateCard components
- Sort by delegator count (default) or total delegated
- Loading skeleton pattern (existing from DirectoryGrid)

**delegate/page.tsx** (auth) -- Protected delegation management page:
- Client component (follows existing (auth) governance pattern from deposit page)
- Check wallet connection, prompt connect if not
- Render DelegationPanel
- Show current delegation status and delegation history from API

**delegates/page.tsx** (public) -- Public delegate directory:
- Server Component with metadata export for SEO
- Render DelegateDirectory with server-side initial data
- Explanatory section: "What is delegation? Inactive token holders can delegate voting power to active contributors."
  </action>
  <verify>
Verify all files exist: `ls apps/web/lib/identity/civic.ts apps/web/components/governance/DelegationPanel.tsx apps/web/components/governance/DelegateCard.tsx apps/web/components/governance/DelegateDirectory.tsx`
Verify pages: `ls apps/web/app/\(auth\)/governance/delegate/page.tsx apps/web/app/\(public\)/governance/delegates/page.tsx`
Run `npx tsc --noEmit` in apps/web -- must compile.
Verify Anchor program usage: `grep "useGsdProgram" apps/web/components/governance/DelegationPanel.tsx`
  </verify>
  <done>
Civic Pass config exported with gatekeeper network addresses. DelegationPanel handles delegate/revoke on-chain transactions. DelegateCard displays delegate info. DelegateDirectory lists active delegates from analytics API. Two new pages: /governance/delegate (auth, management) and /governance/delegates (public, directory).
  </done>
</task>

<task type="auto">
  <name>Task 2: Create QuadraticVoteDisplay, HumanVerificationBadge, DecayedScoreDisplay, and integrate with governance dashboard</name>
  <files>
    apps/web/components/governance/QuadraticVoteDisplay.tsx
    apps/web/components/governance/HumanVerificationBadge.tsx
    apps/web/components/governance/DecayedScoreDisplay.tsx
    apps/web/app/(public)/governance/dashboard/page.tsx
  </files>
  <action>
**QuadraticVoteDisplay.tsx** -- Component showing quadratic vote weight:
- Props: `{ depositedAmount: string, isQuadratic: boolean, delegatedAmount?: string }`
- When quadratic: Show "sqrt(tokens) = vote weight" formula visually. E.g., "sqrt(10,000) = 100 vote weight"
- When linear: Show "10,000 tokens = 10,000 vote weight"
- If delegatedAmount: Show breakdown "Your deposit: X + Delegated: Y = Total: Z -> sqrt(Z) = W weight"
- Use emerald accent colors consistent with GSD theme

**HumanVerificationBadge.tsx** -- Badge component for Civic Pass status:
- Props: `{ wallet: string }` or `{ verified: boolean, expiresAt?: string }`
- Fetches from `/api/governance/human-verification?wallet=X` if only wallet provided (TanStack Query)
- Shows: green shield icon + "Verified Human" when verified, gray icon + "Not Verified" when not
- If expired: yellow icon + "Verification Expired -- Re-verify"
- Click behavior: Link to /governance/delegate page where they can start verification flow
- Small inline badge variant for use in voter lists

**DecayedScoreDisplay.tsx** -- Component showing original vs decayed score:
- Props: `{ wallet: string }` or `{ originalScore: string, decayedScore: string, decayedTotal: string }`
- Fetches from `/api/governance/decay` (POST with wallet) if only wallet provided
- Shows: "Base Score: 15,000" and "Effective Score: 12,340 (with 180-day decay)"
- Visual bar showing decay percentage
- Tooltip or expandable section: "Your contribution scores decay over time. Complete new verified tasks to maintain your effective score."
- Show projected score at 30/60/90 days using decayMultiplier from @gsd/utils (client-side computation)

**dashboard/page.tsx** -- MODIFY existing governance dashboard:
- Read existing dashboard page first to understand current layout
- Add section for "Advanced Governance" at the bottom or in a new tab:
  - Quadratic voting status: "Enabled" / "Disabled" with current gatekeeper network
  - Delegation summary: total delegations, total delegated tokens (from analytics API)
  - Link to /governance/delegates for full directory
  - Link to /governance/delegate for managing own delegation
- If GovernanceConfig indicates quadratic is enabled, modify existing VotingPowerDisplay integration to show QuadraticVoteDisplay instead
- Add HumanVerificationBadge next to voter wallet addresses where they appear
  </action>
  <verify>
Verify components: `ls apps/web/components/governance/QuadraticVoteDisplay.tsx apps/web/components/governance/HumanVerificationBadge.tsx apps/web/components/governance/DecayedScoreDisplay.tsx`
Run `npx tsc --noEmit` in apps/web -- must compile.
Verify dashboard updated: `grep -E "QuadraticVoteDisplay|DelegationPanel|DecayedScoreDisplay" apps/web/app/\(public\)/governance/dashboard/page.tsx`
Verify decay projection: `grep "decayMultiplier" apps/web/components/governance/DecayedScoreDisplay.tsx`
  </verify>
  <done>
QuadraticVoteDisplay shows sqrt formula with token breakdown. HumanVerificationBadge shows Civic Pass status with color-coded icons. DecayedScoreDisplay shows original vs effective score with 30/60/90 day projections. Governance dashboard integrates all three with delegation summary section.
  </done>
</task>

</tasks>

<verification>
- All 10 new/modified files compile with `npx tsc --noEmit`
- DelegationPanel submits on-chain transactions via Anchor
- Components fetch from correct API endpoints
- Dashboard shows advanced governance section
- Decay projections computed client-side using shared utility
</verification>

<success_criteria>
- User can delegate and revoke via DelegationPanel
- Delegate directory shows all active delegates
- QuadraticVoteDisplay shows sqrt weight calculation
- HumanVerificationBadge shows Civic Pass status
- DecayedScoreDisplay shows original vs effective score with projections
- Governance dashboard integrates all new components
</success_criteria>

<output>
After completion, create `.planning/phases/06-advanced-governance/06-06-SUMMARY.md`
</output>
