---
phase: 06-advanced-governance
plan: 07
type: execute
wave: 5
depends_on: ["06-05", "06-06"]
files_modified:
  - apps/web/app/(public)/governance/analytics/page.tsx
  - apps/web/components/governance/GovernanceAnalytics.tsx
  - apps/web/components/governance/ParticipationChart.tsx
  - apps/web/components/governance/VotingPowerDistribution.tsx
autonomous: true
user_setup:
  - service: recharts
    why: "Governance analytics charts (participation trends, power distribution)"
    env_vars: []
    dashboard_config: []

must_haves:
  truths:
    - "Analytics dashboard shows voter turnout per round as a bar/line chart"
    - "Analytics dashboard shows voting power distribution with Gini coefficient and top-10 concentration"
    - "Analytics dashboard shows delegation network stats (total delegations, top delegates)"
    - "Analytics dashboard shows participation trends (30/60/90 day rolling averages)"
    - "Charts are responsive and work on mobile screens"
  artifacts:
    - path: "apps/web/app/(public)/governance/analytics/page.tsx"
      provides: "Public governance analytics page"
      contains: "GovernanceAnalytics"
    - path: "apps/web/components/governance/GovernanceAnalytics.tsx"
      provides: "Main analytics container component"
      contains: "GovernanceAnalytics"
    - path: "apps/web/components/governance/ParticipationChart.tsx"
      provides: "Voter turnout chart using recharts"
      contains: "BarChart"
    - path: "apps/web/components/governance/VotingPowerDistribution.tsx"
      provides: "Power distribution visualization"
      contains: "PieChart"
  key_links:
    - from: "apps/web/components/governance/GovernanceAnalytics.tsx"
      to: "/api/governance/analytics"
      via: "TanStack Query fetch"
      pattern: "api/governance/analytics"
    - from: "apps/web/components/governance/ParticipationChart.tsx"
      to: "recharts"
      via: "Chart library import"
      pattern: "from.*recharts"
    - from: "apps/web/components/governance/VotingPowerDistribution.tsx"
      to: "recharts"
      via: "Chart library import"
      pattern: "from.*recharts"
---

<objective>
Build the governance analytics dashboard with interactive charts showing voter participation trends, voting power distribution, delegation network stats, and quadratic voting impact metrics.

Purpose: Data-driven governance decisions require transparent analytics. The dashboard makes power distribution visible, tracks participation health, and quantifies the impact of quadratic voting on whale reduction.
Output: Analytics page with recharts-powered charts for participation, power distribution, and delegation metrics.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/06-advanced-governance/06-RESEARCH.md
@.planning/phases/06-advanced-governance/06-05-SUMMARY.md
@.planning/phases/06-advanced-governance/06-06-SUMMARY.md

# Key source files
@apps/web/app/(public)/governance/page.tsx
@apps/web/app/(public)/governance/dashboard/page.tsx
@apps/web/app/api/governance/analytics/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install recharts and create ParticipationChart and VotingPowerDistribution chart components</name>
  <files>
    apps/web/components/governance/ParticipationChart.tsx
    apps/web/components/governance/VotingPowerDistribution.tsx
  </files>
  <action>
First, install recharts: `cd apps/web && pnpm add recharts`

**ParticipationChart.tsx** -- Client component for voter turnout visualization:
- Props: `{ turnoutByRound: Array<{ roundIndex: number, turnout: number }>, participationTrends: Array<{ period: string, avgTurnout: number, uniqueVoters: number }> }`
- Use recharts `ResponsiveContainer`, `BarChart`, `Bar`, `XAxis`, `YAxis`, `Tooltip`, `CartesianGrid`
- Primary chart: Bar chart showing turnout percentage per round (X axis = round number, Y axis = turnout %)
- Secondary section: Participation trends table showing 30/60/90 day rolling averages
- Color scheme: emerald-500 for bars (GSD brand), zinc-700 grid, zinc-400 text
- Responsive: Full width, 300px height, works in mobile viewport
- Handle empty data gracefully: "No voting rounds completed yet" message

**VotingPowerDistribution.tsx** -- Client component for power distribution:
- Props: `{ powerDistribution: { giniCoefficient: number, top10Percentage: number, totalVoters: number }, quadraticImpact?: { whaleReduction: number, smallHolderBoost: number } }`
- Use recharts `ResponsiveContainer`, `PieChart`, `Pie`, `Cell`, `Tooltip`, `Legend`
- Primary chart: Pie chart showing top-10 vs rest voting power split
- Stat cards below chart:
  - "Gini Coefficient: 0.XX" (with color indicator: green < 0.4, yellow 0.4-0.6, red > 0.6)
  - "Top 10 Hold: XX% of voting power"
  - "Total Active Voters: N"
- If quadraticImpact provided: Show comparison section
  - "Whale Reduction: -XX% voting power for top 10"
  - "Small Holder Boost: +XX% voting power for bottom 50"
- Color scheme: emerald for "rest", amber for "top 10"
- Handle empty data: "Deposit tokens to see power distribution"
  </action>
  <verify>
Verify recharts installed: `grep "recharts" apps/web/package.json`
Verify components: `ls apps/web/components/governance/ParticipationChart.tsx apps/web/components/governance/VotingPowerDistribution.tsx`
Verify recharts imports: `grep "from.*recharts" apps/web/components/governance/ParticipationChart.tsx`
Run `npx tsc --noEmit` in apps/web -- must compile.
  </verify>
  <done>
recharts installed. ParticipationChart shows voter turnout bar chart per round with trend stats. VotingPowerDistribution shows top-10 vs rest pie chart with Gini indicator and quadratic impact metrics. Both responsive and theme-consistent.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create GovernanceAnalytics container and public analytics page</name>
  <files>
    apps/web/components/governance/GovernanceAnalytics.tsx
    apps/web/app/(public)/governance/analytics/page.tsx
  </files>
  <action>
**GovernanceAnalytics.tsx** -- Client component, main analytics container:
- Fetches from `/api/governance/analytics` via TanStack Query (with 5-min staleTime matching API cache)
- Layout: Grid with sections:
  1. **Participation** -- ParticipationChart with turnoutByRound and participationTrends data
  2. **Voting Power** -- VotingPowerDistribution with powerDistribution and quadraticImpact data
  3. **Delegation Network** -- Stats cards:
     - "Active Delegations: N"
     - "Total Delegated: X tokens"
     - Top 5 delegates list with DelegateCard-style entries (wallet, count, amount)
  4. **Quick Stats** row at top:
     - Total Rounds (from turnoutByRound length)
     - Average Turnout (computed from trends)
     - Active Voters (from powerDistribution.totalVoters)
     - Delegated Tokens (from delegationStats.totalDelegatedTokens)
- Loading state: Skeleton cards + "Loading analytics..." text
- Error state: "Failed to load analytics. Please try again."
- Use existing UI patterns: Card component, emerald accents, zinc backgrounds

**analytics/page.tsx** -- Public analytics page:
- Server Component with metadata: `{ title: "Governance Analytics | GSD Community Hub", description: "Real-time governance participation, voting power distribution, and delegation analytics" }`
- Renders page header: "Governance Analytics" with subtitle "Data-driven insights into governance health and participation"
- Renders GovernanceAnalytics client component
- Add navigation link to this page from the main governance overview page (/governance) -- read the existing governance page.tsx and add a card/link for "Analytics Dashboard"
- Also add link from governance dashboard page
  </action>
  <verify>
Verify files: `ls apps/web/components/governance/GovernanceAnalytics.tsx apps/web/app/\(public\)/governance/analytics/page.tsx`
Run `npx tsc --noEmit` in apps/web -- must compile.
Verify data fetching: `grep "api/governance/analytics" apps/web/components/governance/GovernanceAnalytics.tsx`
Verify navigation: `grep -r "analytics" apps/web/app/\(public\)/governance/page.tsx` should show link to analytics
  </verify>
  <done>
GovernanceAnalytics fetches from analytics API and renders 4 sections (participation, power, delegation, quick stats). Public analytics page has SEO metadata and renders the container. Navigation links added from governance overview and dashboard pages.
  </done>
</task>

</tasks>

<verification>
- `pnpm build` in apps/web compiles successfully (or at minimum `npx tsc --noEmit`)
- recharts renders charts (visual verification via dev server)
- Analytics page accessible at /governance/analytics
- Charts handle empty data without crashing
- Mobile responsive layout works
</verification>

<success_criteria>
- Participation chart shows voter turnout per round
- Power distribution shows Gini coefficient and top-10 concentration
- Delegation stats show total delegations and top delegates
- Analytics page is publicly accessible and linked from governance pages
- All charts render correctly with recharts (responsive, themed)
</success_criteria>

<output>
After completion, create `.planning/phases/06-advanced-governance/06-07-SUMMARY.md`
</output>
