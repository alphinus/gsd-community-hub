---
phase: 04-revenue-mechanics
plan: 05
type: execute
wave: 4
depends_on: ["04-03", "04-04"]
files_modified:
  - apps/web/components/treasury/RevenueDistribution.tsx
  - apps/web/components/treasury/ClaimPanel.tsx
  - apps/web/components/treasury/BurnHistory.tsx
  - apps/web/components/treasury/TreasuryDashboard.tsx
  - apps/web/app/(public)/treasury/page.tsx
autonomous: false

must_haves:
  truths:
    - "Treasury dashboard shows real burn totals from API (not placeholder zero)"
    - "Revenue distribution tab shows all revenue events with their 60/20/10/10 split breakdowns"
    - "Connected wallet user can see their claimable revenue shares and claim history"
    - "Burn history tab shows every burn event traceable to its originating revenue event"
    - "Dashboard auto-refreshes revenue data alongside existing balance data"
  artifacts:
    - path: "apps/web/components/treasury/RevenueDistribution.tsx"
      provides: "Revenue event list with split visualization"
      contains: "RevenueDistribution"
    - path: "apps/web/components/treasury/ClaimPanel.tsx"
      provides: "Per-wallet claim interface showing eligible and claimed shares"
      contains: "ClaimPanel"
    - path: "apps/web/components/treasury/BurnHistory.tsx"
      provides: "Burn event log with traceability links"
      contains: "BurnHistory"
    - path: "apps/web/components/treasury/TreasuryDashboard.tsx"
      provides: "Updated dashboard with real burn totals"
      contains: "burnTotal|totalGsdBurned"
    - path: "apps/web/app/(public)/treasury/page.tsx"
      provides: "Treasury page with revenue tabs"
      contains: "RevenueDistribution|ClaimPanel|BurnHistory"
  key_links:
    - from: "apps/web/components/treasury/RevenueDistribution.tsx"
      to: "apps/web/app/api/revenue/events/route.ts"
      via: "TanStack Query fetching /api/revenue/events"
      pattern: "api/revenue/events"
    - from: "apps/web/components/treasury/ClaimPanel.tsx"
      to: "apps/web/app/api/revenue/claims/route.ts"
      via: "TanStack Query fetching /api/revenue/claims"
      pattern: "api/revenue/claims"
    - from: "apps/web/components/treasury/BurnHistory.tsx"
      to: "apps/web/app/api/revenue/burns/route.ts"
      via: "TanStack Query fetching /api/revenue/burns"
      pattern: "api/revenue/burns"
    - from: "apps/web/components/treasury/TreasuryDashboard.tsx"
      to: "apps/web/app/api/revenue/summary/route.ts"
      via: "TanStack Query fetching /api/revenue/summary"
      pattern: "api/revenue/summary"
---

<objective>
Build revenue distribution UI components and integrate them into the treasury dashboard: event list with split breakdowns, per-wallet claim panel, burn history with traceability, and real burn totals.

Purpose: Make all revenue distribution history publicly viewable (REVN-07) and provide contributors with a claim interface.
Output: 3 new UI components, updated dashboard and treasury page with revenue tabs
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-revenue-mechanics/04-RESEARCH.md
@.planning/phases/04-revenue-mechanics/04-03-SUMMARY.md
@.planning/phases/04-revenue-mechanics/04-04-SUMMARY.md

# Existing treasury dashboard components
@apps/web/components/treasury/TreasuryDashboard.tsx
@apps/web/components/treasury/TransactionList.tsx
@apps/web/app/(public)/treasury/page.tsx

# UI component patterns
@apps/web/components/governance/RoundCard.tsx
@apps/web/components/governance/VotePanel.tsx
@apps/web/components/contributions/ContributionList.tsx

# Types
@packages/types/src/revenue.ts
@packages/types/src/treasury.ts

# Wallet hook for claim panel
@apps/web/components/wallet/WalletConnectButton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create revenue distribution, claim, and burn UI components</name>
  <files>
    apps/web/components/treasury/RevenueDistribution.tsx
    apps/web/components/treasury/ClaimPanel.tsx
    apps/web/components/treasury/BurnHistory.tsx
  </files>
  <action>
Create three new client components in `apps/web/components/treasury/`:

**RevenueDistribution.tsx** -- Revenue event list with split visualization:
- "use client" directive
- Import `useQuery` from `@tanstack/react-query`
- Fetch from `/api/revenue/events` with 30-second refetch interval
- Display a list of revenue events, each showing:
  - Event index (#1, #2, etc.)
  - Token type badge (SOL or USDC) with appropriate color
  - Total amount (formatted with 4 decimal places for SOL, 2 for USDC)
  - Split breakdown as a horizontal bar or 4 labeled amounts: Developer (60%), Treasury (20%), Burn (10%), Maintenance (10%)
  - Status badge: Recorded (yellow), Distributing (blue), Completed (green)
  - Claim count (from _count.claims)
  - "View on Explorer" link using `explorerUrl` helper (link to origin transaction)
  - Recorded date
- Loading state: skeleton cards (follow ContributionList pattern)
- Empty state: "No revenue events yet" message with explanation
- Pagination: page/limit with next/prev buttons (follow existing pagination pattern)
- Use emerald accent colors consistent with GSD theme
- Format BigInt string amounts: divide by 1e9 for SOL, 1e6 for USDC

**ClaimPanel.tsx** -- Per-wallet claim interface:
- "use client" directive
- Import `useWallet` from `@solana/wallet-adapter-react`
- Import `useQuery` from `@tanstack/react-query`
- If no wallet connected: show "Connect wallet to view your revenue claims" message
- If wallet connected: fetch from `/api/revenue/claims?wallet={publicKey}`
- Display:
  - Summary card: Total claimed across all events (sum of amounts)
  - List of claims per revenue event:
    - Event index and token type
    - Contributor's score / total score (percentage)
    - Amount claimed (formatted)
    - Claimed date
    - Transaction signature link (Explorer)
  - If no claims: "No revenue claims yet. Claims become available when revenue events are recorded and your contribution score is registered."
- Loading state: skeleton list
- NOTE: In v1, the actual claim transaction is initiated server-side after the admin records the revenue event. This panel shows claim HISTORY, not a "claim now" button. Future iteration can add wallet-signed claim transactions.

**BurnHistory.tsx** -- Burn event log with traceability:
- "use client" directive
- Import `useQuery` from `@tanstack/react-query`
- Fetch from `/api/revenue/burns` with 30-second refetch
- Display a list of burn events, each showing:
  - Revenue event index this burn originated from (traceability -- REVN-06)
  - Token input: burn_amount in SOL/USDC (what was swapped)
  - $GSD output: gsd_burned (what was burned)
  - Burn signature link (Explorer) -- the Jupiter swap + burn transaction
  - Origin signature link (Explorer) -- the original revenue transaction
  - Date
- Visual element: fire/burn icon or red accent for burn amounts
- Empty state: "No burns recorded yet. Burns are triggered automatically when revenue events are processed."
- Loading state: skeleton rows
- Format: show both input (SOL/USDC) and output ($GSD) to illustrate the conversion
  </action>
  <verify>TypeScript compiles for all 3 component files. Components export default functions. No import errors.</verify>
  <done>Three revenue UI components render data from API endpoints with proper loading states, empty states, pagination, and Explorer links</done>
</task>

<task type="auto">
  <name>Task 2: Integrate revenue components into treasury dashboard</name>
  <files>
    apps/web/components/treasury/TreasuryDashboard.tsx
    apps/web/app/(public)/treasury/page.tsx
  </files>
  <action>
**Update TreasuryDashboard.tsx** -- Replace burn placeholder with real data:
- Add a TanStack Query fetch to `/api/revenue/summary` alongside existing balance fetch
- Replace the hardcoded burn total ("0 $GSD burned") with real data from the summary endpoint: `{totalGsdBurned} $GSD burned`
- Also display: `{eventCount} revenue events` and `{totalDistributed} distributed` as additional stat cards
- Keep existing SOL balance and $GSD balance cards
- Add a "Revenue Summary" section below balances showing:
  - Total revenue received (all events)
  - Total distributed to contributors
  - Total $GSD burned
  - Number of revenue events
- Format BigInt strings: divide by appropriate decimals (1e9 for SOL amounts, token decimals for $GSD)
- Keep existing 30-second auto-refresh via TanStack Query
- Keep the existing skeleton loading pattern

**Update treasury/page.tsx** -- Add tabbed navigation for revenue views:
- Import the 3 new components: RevenueDistribution, ClaimPanel, BurnHistory
- Add a simple tab system below the existing TreasuryDashboard (balance cards):
  - Tab 1: "Transactions" (existing TransactionList) -- DEFAULT
  - Tab 2: "Revenue Events" (RevenueDistribution)
  - Tab 3: "My Claims" (ClaimPanel)
  - Tab 4: "Burns" (BurnHistory)
- Use a `useState` for active tab with simple button-based tab switcher
- Tab buttons: styled with GSD theme (emerald underline for active tab, zinc for inactive)
- Each tab renders its component only when active (conditional rendering, not hidden)
- Keep existing treasury page structure: hero section at top, then dashboard (balances), then tabs
- Tab switcher should be client-side, so wrap the tab section in a small client component or convert the relevant section. The simplest approach: create the tab logic inline in the page or use a small `TreasuryTabs` wrapper component.
- Since the treasury page is currently a Server Component, the tabs section needs to be a Client Component. Either: (a) add a `TreasuryTabs` client component that wraps all tabs, or (b) convert the page to "use client". Prefer (a) to keep SEO benefits of the server-rendered hero/balance section.
  </action>
  <verify>Run dev server: `cd apps/web && pnpm dev`. Navigate to /treasury. Verify: burn total shows data from summary API (0 if no events), tab navigation works, each tab renders its component.</verify>
  <done>Treasury dashboard shows real burn totals (not placeholder), revenue tabs navigate between transactions/events/claims/burns, all components fetch from API with auto-refresh</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify treasury dashboard with revenue integration</name>
  <files>apps/web/app/(public)/treasury/page.tsx</files>
  <action>
Revenue distribution UI integrated into treasury dashboard with real burn totals, tabbed navigation (Transactions/Revenue Events/My Claims/Burns), and data fetching from revenue API endpoints.

Verification steps:
1. Navigate to http://localhost:3000/treasury
2. Verify the burn total card shows data from API (0 $GSD burned is expected if no events)
3. Click each tab: "Transactions" (existing), "Revenue Events", "My Claims", "Burns"
4. Verify "Revenue Events" tab shows empty state message
5. Verify "My Claims" tab prompts wallet connection (or shows empty state if connected)
6. Verify "Burns" tab shows empty state message
7. Verify dark theme consistency (emerald accents, zinc backgrounds)
8. Verify tab switching is smooth with no flash

Resume signal: Type "approved" or describe issues to fix
  </action>
  <verify>User visually confirms all 4 tabs render correctly on /treasury with proper empty states and dark theme consistency.</verify>
  <done>Treasury dashboard displays revenue tabs, burn totals from API, and consistent GSD dark theme -- approved by user</done>
</task>

</tasks>

<verification>
1. Treasury dashboard renders with real burn totals from /api/revenue/summary
2. Tab navigation between 4 views works without page reload
3. Revenue Events tab shows paginated event list (or empty state)
4. My Claims tab shows per-wallet claims (or wallet connect prompt)
5. Burns tab shows burn history (or empty state)
6. All components have loading skeletons
7. Dark theme consistent with existing GSD design
8. Explorer links correctly formatted
</verification>

<success_criteria>
- Treasury burn total uses real data from API (not hardcoded zero)
- 4 tabs navigate between Transactions, Revenue Events, My Claims, Burns
- Revenue events show 60/20/10/10 split breakdowns
- Claims show per-wallet history with contribution score context
- Burns show traceability from revenue event to $GSD burn
- Human verification checkpoint approved
</success_criteria>

<output>
After completion, create `.planning/phases/04-revenue-mechanics/04-05-SUMMARY.md`
</output>
